<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Updated viewport to prevent manual zoom and ensure auto-zoom on mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flappy Bird</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
            /* Added mobile-specific body styling */
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 400px;
            max-height: 600px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 70%, #228B22 100%);
            overflow: hidden;
            border: 2px solid #333;
            border-radius: 10px;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: pointer;
            /* Prevent touch callouts and selections on mobile */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            z-index: 10;
        }

        .start-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .start-screen p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
        }

        .game-over h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #FF6B6B;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .score-display {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .restart-btn {
            padding: 16px 32px;
            font-size: 1.2rem;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-height: 48px;
        }

        .restart-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .score-counter {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 5;
        }

        .high-score {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            z-index: 5;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 480px) {
            /* Enhanced mobile styling for better auto-zoom */
            html, body {
                width: 100%;
                height: 100%;
                position: fixed;
                overflow: hidden;
            }
            
            body {
                padding: 0;
                margin: 0;
            }
            
            .game-container {
                border-radius: 0;
                border: none;
                max-width: 100vw;
                max-height: 100vh;
                width: 100vw;
                height: 100vh;
                position: fixed;
                top: 0;
                left: 0;
            }
            
            .start-screen h1 {
                font-size: 2rem;
            }
            
            .start-screen p {
                font-size: 1rem;
            }
        }
        
        /* Enhanced tablet and mobile optimizations */
        @media (max-width: 768px) {
            html, body {
                width: 100%;
                height: 100%;
                position: fixed;
                overflow: hidden;
            }
            
            .game-container {
                max-width: 100vw;
                max-height: 100vh;
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                border: none;
                position: fixed;
                top: 0;
                left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="score-counter" id="scoreCounter">0</div>
        <div class="high-score" id="highScore">Best: 0</div>
        
        <div class="ui-overlay start-screen" id="startScreen">
            <h1>üê¶ Flappy Bird</h1>
            <p>Tap to fly and avoid the pipes!</p>
            <!-- Added start button to the start screen -->
            <button class="restart-btn" id="startBtn">Start Game</button>
        </div>
        
        <div class="ui-overlay game-over" id="gameOverScreen" style="display: none;">
            <h2>Game Over!</h2>
            <div class="score-display" id="finalScore">Score: 0</div>
            <button class="restart-btn" id="restartBtn">Play Again</button>
        </div>
    </div>

    <script>
        class FlappyBirdGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.startScreen = document.getElementById('startScreen');
                this.gameOverScreen = document.getElementById('gameOverScreen');
                this.scoreCounter = document.getElementById('scoreCounter');
                this.highScoreDisplay = document.getElementById('highScore');
                this.finalScore = document.getElementById('finalScore');
                this.restartBtn = document.getElementById('restartBtn');
                this.startBtn = document.getElementById('startBtn');
                
                this.setupCanvas();
                this.initGame();
                this.setupEventListeners();
                this.loadHighScore();
                this.gameLoop();
            }
            
            setupCanvas() {
                const container = this.canvas.parentElement;
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
                
                // Handle resize
                window.addEventListener('resize', () => {
                    this.canvas.width = container.clientWidth;
                    this.canvas.height = container.clientHeight;
                });
            }
            
            initGame() {
                this.gameState = 'start'; // 'start', 'playing', 'gameOver'
                this.score = 0;
                this.highScore = parseInt(localStorage.getItem('flappyBirdHighScore')) || 0;
                
                // Bird properties
                this.bird = {
                    x: this.canvas.width * 0.2,
                    y: this.canvas.height / 2,
                    width: 30,
                    height: 25,
                    velocity: 0,
                    gravity: 0.5,
                    jumpPower: -8,
                    rotation: 0
                };
                
                // Pipes
                this.pipes = [];
                this.pipeWidth = 60;
                this.pipeGap = 150;
                this.pipeSpeed = 2;
                this.lastPipeTime = 0;
                this.pipeInterval = 2000; // 2 seconds
                
                // Background
                this.backgroundX = 0;
                this.backgroundSpeed = 0.5;
                
                this.updateHighScoreDisplay();
            }
            
            setupEventListeners() {
                this.canvas.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleInput(e);
                });
                
                this.canvas.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleInput(e);
                });
                
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleInput(e);
                }, { passive: false });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                }, { passive: false });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });
                
                // Keyboard events
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.handleInput(e);
                    }
                });
                
                this.startBtn.addEventListener('click', () => this.startGame());
                
                // Restart button
                this.restartBtn.addEventListener('click', () => this.restart());
                
                this.canvas.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });
            }
            
            handleInput(e) {
                if (this.gameState === 'playing') {
                    this.bird.velocity = this.bird.jumpPower;
                }
            }
            
            startGame() {
                this.gameState = 'playing';
                this.startScreen.style.display = 'none';
                this.lastPipeTime = Date.now();
            }
            
            restart() {
                this.gameOverScreen.style.display = 'none';
                this.initGame();
                this.gameState = 'start';
                this.startScreen.style.display = 'flex';
            }
            
            update() {
                if (this.gameState !== 'playing') return;
                
                // Update bird
                this.bird.velocity += this.bird.gravity;
                this.bird.y += this.bird.velocity;
                
                // Bird rotation based on velocity
                this.bird.rotation = Math.min(Math.max(this.bird.velocity * 3, -30), 90);
                
                // Generate pipes
                const currentTime = Date.now();
                if (currentTime - this.lastPipeTime > this.pipeInterval) {
                    this.generatePipe();
                    this.lastPipeTime = currentTime;
                }
                
                // Update pipes
                this.pipes.forEach((pipe, index) => {
                    pipe.x -= this.pipeSpeed;
                    
                    // Remove off-screen pipes and increase score
                    if (pipe.x + this.pipeWidth < 0) {
                        this.pipes.splice(index, 1);
                        if (!pipe.scored) {
                            this.score++;
                            this.updateScore();
                            pipe.scored = true;
                        }
                    }
                    
                    // Score when bird passes pipe
                    if (!pipe.scored && pipe.x + this.pipeWidth < this.bird.x) {
                        this.score++;
                        this.updateScore();
                        pipe.scored = true;
                    }
                });
                
                // Update background
                this.backgroundX -= this.backgroundSpeed;
                if (this.backgroundX <= -this.canvas.width) {
                    this.backgroundX = 0;
                }
                
                // Check collisions
                this.checkCollisions();
            }
            
            generatePipe() {
                const minGapY = 100;
                const maxGapY = this.canvas.height - this.pipeGap - 100;
                const gapY = Math.random() * (maxGapY - minGapY) + minGapY;
                
                this.pipes.push({
                    x: this.canvas.width,
                    topHeight: gapY,
                    bottomY: gapY + this.pipeGap,
                    bottomHeight: this.canvas.height - (gapY + this.pipeGap),
                    scored: false
                });
            }
            
            checkCollisions() {
                // Ground and ceiling collision
                if (this.bird.y + this.bird.height >= this.canvas.height || this.bird.y <= 0) {
                    this.gameOver();
                    return;
                }
                
                // Pipe collision
                this.pipes.forEach(pipe => {
                    if (this.bird.x < pipe.x + this.pipeWidth &&
                        this.bird.x + this.bird.width > pipe.x) {
                        
                        if (this.bird.y < pipe.topHeight ||
                            this.bird.y + this.bird.height > pipe.bottomY) {
                            this.gameOver();
                        }
                    }
                });
            }
            
            gameOver() {
                this.gameState = 'gameOver';
                
                // Update high score
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    localStorage.setItem('flappyBirdHighScore', this.highScore.toString());
                    this.updateHighScoreDisplay();
                }
                
                this.finalScore.textContent = `Score: ${this.score}`;
                this.gameOverScreen.style.display = 'flex';
            }
            
            updateScore() {
                this.scoreCounter.textContent = this.score;
            }
            
            updateHighScoreDisplay() {
                this.highScoreDisplay.textContent = `Best: ${this.highScore}`;
            }
            
            loadHighScore() {
                this.highScore = parseInt(localStorage.getItem('flappyBirdHighScore')) || 0;
                this.updateHighScoreDisplay();
            }
            
            draw() {
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw parallax background
                this.drawBackground();
                
                if (this.gameState === 'playing' || this.gameState === 'gameOver') {
                    // Draw pipes
                    this.drawPipes();
                    
                    // Draw bird
                    this.drawBird();
                }
            }
            
            drawBackground() {
                // Sky gradient
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(0.7, '#98FB98');
                gradient.addColorStop(1, '#228B22');
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Simple cloud effect
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                for (let i = 0; i < 3; i++) {
                    const x = (this.backgroundX + i * 150) % (this.canvas.width + 100);
                    const y = 50 + i * 30;
                    this.drawCloud(x, y);
                }
            }
            
            drawCloud(x, y) {
                this.ctx.beginPath();
                this.ctx.arc(x, y, 20, 0, Math.PI * 2);
                this.ctx.arc(x + 25, y, 25, 0, Math.PI * 2);
                this.ctx.arc(x + 50, y, 20, 0, Math.PI * 2);
                this.ctx.arc(x + 25, y - 15, 15, 0, Math.PI * 2);
                this.ctx.fill();
            }
            
            drawBird() {
                this.ctx.save();
                this.ctx.translate(this.bird.x + this.bird.width/2, this.bird.y + this.bird.height/2);
                this.ctx.rotate(this.bird.rotation * Math.PI / 180);
                
                // Bird body
                this.ctx.fillStyle = '#FFD700';
                this.ctx.fillRect(-this.bird.width/2, -this.bird.height/2, this.bird.width, this.bird.height);
                
                // Bird wing
                this.ctx.fillStyle = '#FFA500';
                this.ctx.fillRect(-this.bird.width/4, -this.bird.height/4, this.bird.width/2, this.bird.height/3);
                
                // Bird eye
                this.ctx.fillStyle = 'white';
                this.ctx.beginPath();
                this.ctx.arc(this.bird.width/4, -this.bird.height/4, 4, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.fillStyle = 'black';
                this.ctx.beginPath();
                this.ctx.arc(this.bird.width/4 + 1, -this.bird.height/4, 2, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Bird beak
                this.ctx.fillStyle = '#FF6B35';
                this.ctx.beginPath();
                this.ctx.moveTo(this.bird.width/2, 0);
                this.ctx.lineTo(this.bird.width/2 + 8, -2);
                this.ctx.lineTo(this.bird.width/2 + 8, 2);
                this.ctx.closePath();
                this.ctx.fill();
                
                this.ctx.restore();
            }
            
            drawPipes() {
                this.pipes.forEach(pipe => {
                    // Top pipe
                    this.ctx.fillStyle = '#228B22';
                    this.ctx.fillRect(pipe.x, 0, this.pipeWidth, pipe.topHeight);
                    
                    // Top pipe cap
                    this.ctx.fillStyle = '#32CD32';
                    this.ctx.fillRect(pipe.x - 5, pipe.topHeight - 20, this.pipeWidth + 10, 20);
                    
                    // Bottom pipe
                    this.ctx.fillStyle = '#228B22';
                    this.ctx.fillRect(pipe.x, pipe.bottomY, this.pipeWidth, pipe.bottomHeight);
                    
                    // Bottom pipe cap
                    this.ctx.fillStyle = '#32CD32';
                    this.ctx.fillRect(pipe.x - 5, pipe.bottomY, this.pipeWidth + 10, 20);
                });
            }
            
            gameLoop() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.gameLoop());
            }
        }
        
        // Start the game when page loads
        window.addEventListener('load', () => {
            new FlappyBirdGame();
        });
    </script>
</body>
</html>

